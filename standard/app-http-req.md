# 客户端HTTP请求的一些规范

一个系统上线后，取经的故事才刚刚开始。

上线后，我们会遇到问题，需要排查问题，因此需要一套能快速定位问题的系统；

上线后，我们还会频繁发布，需要做到不停服更新以及灰度发布；

这些，都需要客户端的一些配合。

### 调用链路追踪

客户端的调用的整个流程的起点，需要客户端这边生成1个uniqueId，并在**每个HTTP请求的Header**中把uniqueId带上，协助服务端做全链路调用的监控。

这里说的客户端包含native和h5的客户端；

#### 规范要求

##### uniqueId生成规则

	yyyyMMddHHmmss_UUID.removeAll("-")

##### uniqueId的key
	
约定header的key为`uid`，譬如

	addHeader("uid", "20150908112333_496e806721684f85a15d61c2ad0dbdcb")

### 灰度发布

客户端可能同时存在多个版本，不同的版本可能会请求到服务端不同的集群；或者灰度发布的时候，会将新发布的app的流量引流到服务端新版本的集群。需要客户端这边在**每个HTTP请求的Header**中把版本号带上，协助服务端完成分流。

这里说的客户端主要指native的客户端和h5的客户端；

#### 规范要求

##### 版本号

- android版本号：`android_app版本号`，譬如android_1.2.20
- ios版本号：`ios_app版本号`，譬如ios_1.2.20
- h5zip版本号：`h5zip_app版本号`，譬如h5zip_1.2.33

**注意**：这里的版本号仅仅是举例，具体的版本号请参考版本号规范

##### 版本号的key
约定header的key为`appversion`

	addHeader("appversion", "ios_1.2.20")
