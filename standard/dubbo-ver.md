## Dubbo服务版本管理规范

### 需求背景

为了在进行服务升级的时候，做到不停机更新，需要对dubbo的服务进行版本化处理，做到新老版本的平滑升级。

### Dubbo Version简介
- Dubbo中的version和group一样，是可以做服务的隔离配置
- 一个服务可以存在多个版本的提供者
- version的配置是无侵入的，不需要改代码，只需要改配置

### version 约束
- 调用Dubbo服务时，只有消费者和提供者的version匹配的话，才能调用到，也就是说需要完全匹配，消费者没有提供version的话，只能调用到没有version的服务提供者。
- 不同version的服务是相互隔离的

### 版本规范
各个系统使用统一的版本号，版本命名规则：**v迭代日期**，便于版本辨识。
例如：应用平台1218迭代的版本号为v20151218。
ps：此版本规范要求每次迭代后所有系统都需要进行升级，即便没有功能更新，也需要更新版本号。

### version配置
对于1个应用来说，可以是服务的消费者，也可以是服务的生产者；

version的配置，只需在`dubbo.properties`里面配置即可；

#### 服务生产者的配置

    dubbo.service.version=v160101

应用的`dubbo.properties`加上这样的一行配置，那么整个应用暴露的Service都会带上这个version

#### 服务消费者的配置
    
    dubbo.reference.version=v160101

应用的`dubbo.properties`加上这样的一行配置，那么整个应用所引用的Service都会带上这个version

### 服务更新规范

- 首先需要梳理出各个服务的调用链，更新操作是从调用链的最低端开始逐层向上更新的；
- 在低压力时间段，先升级调用链最底层一半的提供者为新版本；
- 然后再升级上一层的一半的提供者为最新版本；
- 依次向上更新到调用链的最顶端，对于最顶端的服务(消费者)可以一次全部升级为最新版本；
- 然后沿着调用链从上到下，逐层更新掉各层剩下的一半服务为最新版本
- 最后登陆dubbo-admin确认是否所有服务的版本号都是最新版本

### 调度任务的版本号
调度系统不再提供任务版本号的配置项，任务调用将不再区分版本号(version="*")
